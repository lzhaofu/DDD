$(function(){$("#CityID").dblclick(function(){fillSelectedCity("CityID","selectBox","CityIDs")});var a=$("#txtCityIDs").val();GetCities($("#txtProvinceID").val(),$("#txtCityID").val(),a=="");a!=""&&a!=undefined&&loadCity(a,"CityID","selectBox","CityIDs")});function fillSelectedCity(b,c,d){$("#"+b).find(":selected").each(function(){$("<li class='pli' tem='"+$(this).val()+"'><span>"+$(this).text()+"</span><a href='javascript:' class='del-city' onclick='delCity(\""+b+'","'+c+'","'+d+"\",this)' ></a></li>").appendTo($("#"+c).find("ul"));$(this).remove()});$("#"+d).val("");var a="";$("#"+c).find(".pli").each(function(){a+=$(this).attr("tem")+","});if(a.length>1)a=a.substring(0,a.length-1);$("#"+d).val(a);$("#"+b)[0].selectedIndex=0}function delCity(b,d,e,g){var a=$(g).parents(".pli"),f=$("<option value='"+a.attr("tem")+"'>"+a.text()+"</option>"),c=false;$("#"+b).find(":selected").each(function(){if($(this).val()==a.attr("tem"))c=true});!c&&a.fadeOut(1,function(){a.remove();$(f).appendTo($("#"+b));$("#"+b)[0].selectedIndex=-1;fillSelectedCity(b,d,e)})}function GetCities(a,c,b){if(a==null||a==""){showMessage("<span class='box-error'>错误</span>","请选择一个有效的省份",true,false,false);return false}$.ajax({url:"/Region/City/GetCities/?pid="+a,type:"get",dataType:"json",success:function(a){$("#CityID").html("");if(a==undefined||a==null){showMessage("<span class='box-error'>错误</span>","网络出现错误,请稍后重试...",true,false,true);return false}for(var e=$("#txtCityIDs").val().split(","),d=0;d<a.length;d++){if(a[d].Value==undefined||a[d].Value==""||a[d].Text==undefined||a[d].Text=="")continue;if(SetCity(e,a[d]))$("<option value='"+a[d].Value+"'>"+a[d].Text+"</option>").appendTo($("#CityID"));else continue}$("#CityID").val(c);b&&fillSelectedCity("CityID","selectBox","CityIDs")},error:function(b,c,a){showMessage("<span class='box-error'>错误</span>",a,true,false,true)}})}function SetCity(a,c){if(a.length>0)for(var b=0;b<a.length;b++)if(c.Value==a[b])return false;return true}function loadCity(b,c,a,d){$.ajax({url:"/Region/City/GetCitiesByIds/?ids="+b,cache:false,type:"get",dataType:"json",success:function(h){for(var f=h.split(","),g=b.split(","),e=0;e<f.length;e++){if(e>=g.length||f[e]=="")continue;$("<li class='pli' tem='"+g[e]+"'><span>"+f[e]+"</span><a href='javascript:' class='del-city' onclick='delCity(\""+c+'","'+a+'","'+d+"\",this)' ></a></li>").appendTo($("#"+a).find("ul"))}},error:function(){alert("网络错误，请稍后再试!")}})}